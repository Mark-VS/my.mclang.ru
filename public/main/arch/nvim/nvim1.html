<!DOCTYPE html>
<html lang="RU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nvim</title>
    <link rel="stylesheet" href="/assets/styles/style.css">
    <link rel="stylesheet" href="/assets/highlight/styles_custom/androidstudio.css">
</head>
<body>
<script src="/assets/highlight/highlight.min.js"></script>
<a href="/arch/nvim">Вернуться назад</a>

<h1>nvim</h1>

<p style="margin-bottom: 6px">Ссылки:</p>
<ul style="margin-top: 6px">
   <li>Офиц. страничка <strong>lazyvim</strong>: <a href="https://www.lazyvim.org/plugins/treesitter">https://www.lazyvim.org/plugins/treesitter</a></li>
   <li><a href="https://marioyepes.com/blog/neovim-ide-with-lua-for-web-development/">https://marioyepes.com/blog/neovim-ide-with-lua-for-web-development/</a></li>
   <li><a href="https://www.josean.com/posts/nvim-treesitter-and-textobjects">https://www.josean.com/posts/nvim-treesitter-and-textobjects</a></li>
</ul>

<ul>
   <li>~/.local/state/nvim/swap/ – здесь хранятся swap-файлы</li>
</ul>
<ul>
   <li>~/.config/nvim/init.lua – основной конфиг</li>
   <li>~/.local/share/nvim/ – configuration cache</li>
</ul>

<p style="margin-bottom: 6px">То есть, если нужно очистить все настройки, то:</p>
<pre style="margin-top: 6px"><code class="language-bash">rm -rf ~/.local/share/nvim
rm -rf ~/.local/state/nvim
rm -rf ~/.config/nvim
</code></pre>


<pre><code class="language-vim">

" Конфигурационные файл: ~/.config/nvim/init.lua, ~/.config/nvim/init.vim
    !!! init.vim - устаревий способ.
    !!! Лучше все настройки указывыать в init.lua.
    
" Если я хочу, чтобы при запуске от root, nvim подцеплял настройки из ~/.config/nvim/init.lua, то запускаем так:
    sudo -E nvim myfile.txt
    
" Шаблоны для базовой настройки можно найти здесь: /usr/share/nvim/runtime/
    /usr/share/nvim/runtime/example_init.lua - это дефолтный шаблон init.lua
    cp /usr/share/nvim/runtime/example_init.lua ~/.config/nvim/init.lua
    " НО это всё не дефолтные настройки. Дефолтный конфиг встроен в lua-код внутри neovim
    " Посммотреть эти дефолтные настройки можно здесь:
        less /usr/share/nvim/runtime/lua/vim/_defaults.lua
    "" Вытаскивать дефолтные настройки оттуда смысла нет. Проще переопределять нужное в ~/.config/nvim/init.lua

        " Применяем цветовую схему:
        vim.cmd.colorscheme('habamax')
        " Убираем фон у основных групп, чтобы сделать всё прозрачным
        vim.api.nvim_set_hl(0, "Normal",      { bg = "NONE" })
        " vim.api.nvim_set_hl(0, "NormalFloat", { bg = "NONE" })
        " vim.api.nvim_set_hl(0, "SignColumn",  { bg = "NONE" })
        " vim.api.nvim_set_hl(0, "LineNr",      { bg = "NONE" })
        vim.api.nvim_set_hl(0, "EndOfBuffer", { bg = "NONE" })
        " vim.api.nvim_set_hl(0, "StatusLine",  { bg = "NONE" })
        " vim.api.nvim_set_hl(0, "StatusLineNC",{ bg = "NONE" })
        " vim.api.nvim_set_hl(0, "TabLineFill", { bg = "NONE" })
        " vim.api.nvim_set_hl(0, "VertSplit",   { bg = "NONE" })
        
    " Перезагрузить настройки из init.lua:
        :source $MYVIMRC
            " или:
        :source ~/.config/nvim/init.lua
        
    " Пример выше затирает цветовую схему 'habamax' и делает настройки такими же, как в терминале.
    " Вот так можно сохранить оригинальный цвет текста из схемы:
             
        vim.cmd.colorscheme('elflord')
        " vim.api.nvim_set_hl(0, "Normal", { fg = "red", bg = "NONE" })
        
        " Получаем текущий цвет текста для Normal
        local normal_fg = vim.api.nvim_get_hl(0, {name = "Normal"}).fg
        
        " Убираем фон у основных групп, и цвет текста применяем тот, который стоит по умолчанию у 'elflord'
        vim.api.nvim_set_hl(0, "Normal",      { fg = normal_fg, bg = "NONE" })
        vim.api.nvim_set_hl(0, "EndOfBuffer", { fg = normal_fg, bg = "NONE" })

                            
</code></pre>


<p style="margin-bottom: 6px">Перемещение</p>
<ul style="margin-top: 6px">
   <li>$ – переместиться в конец текущей строки</li>
   <li>5$ – переместиться на 5-ую строку, начиная с текущей, в конец строки</li>
   <li>0 – переместить курсор в начало текущей строки</li>
   <li>^ или _ – переместить курсор в начало строки на первый непустой символ</li>
   <li>G – переместить курсор на последнюю строку</li>
   <li>gg – переместить курсор на первую строку</li>
   <li>:7 – перейти на 7-ю строку</li>
   <li>w – начало следующего слова</li>
   <li>e – конец текущего или следующего слова</li>
   <li>b – начало текущего или предыдущего слова</li>
   <li>H – верх экрана</li>
   <li>M – центр экрана</li>
   <li>L – низ экрана</li>
   <li>-</li>
   <li>Shift+[ – прыгаем вверх между абзацами</li>
   <li>Shift+] – прыгаем вниз между абзацами</li>
   <li>Ctrl+f или PageDown – переместиться на страницу ниже</li>
   <li>Ctrl+b или PageUp – переместиться на страницу выше</li>
   <li>-</li>
   <li>f – прыгнуть к ближайшему символу на строке справа</li>
   <li>F – прыгнуть к ближайшему символу на строке слева</li>
   <li>t (till) – прыгнуть к ближайшему символу на строке справа в позицию ПЕРЕД</li>
   <li>T – прыгнуть к ближейшему символу на строке слева в позицию ПЕРЕД</li>
   <li>-</li>
   <li>dt, – удалить в текущей строке всё до первой запятой</li>
   <li>ct, – заменить в текущей строке всё до первой запятой (то есть, то же, что и <strong><i>dt,</i></strong>, только сразу же переходим в INSERT mode)</li>
   <li>vt, – выделить в текущей строке всё до первой запятой</li>
   <li>cc – заменить строку целиком (то есть, то же, что и <strong><i>dd</i></strong> + INSERT mode)</li>
   <li>ciw – заменить слово</li>
   <li>ci( – заменить внутри скобок</li>
</ul>

<p style="margin-bottom: 6px">Режим вставки</p>
<ul style="margin-top: 6px">
   <li>i – вставить ДО текущей буквы</li>
   <li>a – вставить ПОСЛЕ текущей буквы</li>
   <li>I – в начало строки</li>
   <li>A – в конец строки</li>
   <li>o – создаёт новую строку и переходит на неё</li>
   <li>O – создаёт новую строку – вставляет её на текущую строку</li>
   <li>:put = '' – то же, что и <strong><i>o</i></strong>, но без перехода в INSERT mode</li>
   <li>:put! = '' – то же, что и <strong><i>O</i></strong>, но без перехода в INSERT mode</li>
   <li>s – удаляет текущий символ</li>
   <li>cl – то же самое, удаляет текущий символ</li>
   <li>S – удаляет текущую строку</li>
   <li>cc – то же самое</li>
   <li>cw – удалить слово от текущей позиции</li>
   <li>ciw – удалить слово целиком</li>
   <li>c$ – удалить до конца строки</li>
   <li>с – в визуальном режиме удаляет всё выделенное</li>
   <li>gi – вернуться к месту последней вставки</li>
   <li>R – режим замены</li>
</ul>
<p style="margin-bottom: 6px">Удаление с сохранением в буфер:</p>
<ul style="margin-top: 6px">
   <li>x – удалить символ</li>
   <li>dis – удалить предложение (delete inner sentence)</li>
   <li>diw – удалить слово под курсором (delete inner word)</li>
   <li>das – удалить предложение (delete a sentence)</li>
   <li>dip – удалить абзац (delete inner paragraph)</li>
   <li>dt, – удалить всё до запятой (delete till comma)</li>
   <li>df, – удалить всё до запятой, включая запятую (delete find comma)</li>
   <li>dfж ‒ удалить всё до буквы "ж", включая её</li>
</ul>
<p style="margin-bottom: 6px">Удаление без сохранения в буфер:</p>
<ul style="margin-top: 6px">
   <li>"_x – удалить символ</li>
   <li>"_dw – удалить оставшуюся часть слова</li>
   <li>"_diw – удалить всё слово целиком</li>
   <li>"_das – удалить предложение</li>
   <li>"_dt, – удалить всё до запятой</li>

</ul>

<p style="margin-bottom: 6px">Поиск:</p>
<ul style="margin-top: 6px">
   <li>/текст – найти текст вниз по файлу</li>
   <li>?текст – найти текст вверх по файлу</li>
   <li>n – повторить поиск в том же направлении</li>
   <li>N – повторить поиск в противоположном направлении</li>
   <li>---</li>
   <li>:nohlsearch = :noh – убрать подсветку найденных строк</li>
</ul>

<p style="margin-bottom: 6px">Копирование</p>
<ul style="margin-top: 6px">
   <li>"+yy – скопировать в буфер обмена текущую строку</li>
   <li>"+2yy – скопировать в буфер обмена две строки</li>
   <li>"+y – скопировать в буфер обмена выделенный текст</li>
   <li>"+p – вставить из буфера обмена</li>
   
</ul>

<p style="margin-bottom: 6px">Буферы</p>
<ul style="margin-top: 6px">
   <li>:e newfile.txt – открыть файл newfile.txt</li>
   <li>:enew – создать пустой буфер без имени</li>
   <li>:ls – список буферов</li>
   <li>:b 2 – перейти к буферу 2</li>
   <li>:b! 2 – перейти к буферу 2 принудительно</li>
   <li>:bprev – предыдущий буфер</li>
   <li>:bnext – следующий</li>
   <li>:bd – закрыть буфер</li>
   <li>:bw – wipeout – для неудаляемых буферов, например netrw</li>
   <li>–</li>
   <li>]b – следующий буфер</li>
   <li>[b – предыдущий буфер </li>
   <li>Ctrl+6 – предыдущий активный буфер</li>
</ul>

<p style="margin-bottom: 6px">окна</p>
<ul style="margin-top: 6px">
   <li>:split / vsplit – разделить окно</li>
   <li>Ctlr-w + hjkl – перемещение между окнами</li>
    <li>Ctlr-w + w – перемещение между окнами</li>
    <li>Ctlr-w + q – закрыть окно</li>
    <li>:close – тоже закрыть окно</li>
</ul>

<p style="margin-bottom: 6px">Вкладки:</p>
<ul style="margin-top: 6px">
   <li>:tabnew anotherfile.txt – новая вкладка</li>
   <li>:tabn – следующая вкладка</li>
   <li>:tabp – предыдущая вкладка</li>
   <li>:tabclose – закрыть вкладку</li>
</ul>


<p style="margin-bottom: 6px">Полезности:</p>
<ul style="margin-top: 6px">
   <li>:number или :nu– включить нумерацию строк</li>
   <li>:nonumber или :nu! – отключить нумерацию строк</li>
</ul>

<p style="margin-bottom: 6px">Комментирование. В Neovim есть встроенный Lua-модуль для комментариев.</p>
<ul style="margin-top: 6px">
   <li>gcc – закомментировать текущую строку</li>
   <li>gc – закомментировать выделенный блок кода</li>
   <li>:set commentstring? – посмотреть "комментарий" для текущего файла</li>
</ul>

<p style="margin-bottom: 6px">Терминал</p>
<ul style="margin-top: 6px; margin-bottom: 6px">
   <li>Ctrl-\ Ctrl-n – выйти из режима термиала</li>
   <li><strong><i>i</i></strong> или <strong><i>a</i></strong> – опять перейти в режим терминала</li>
   <li>:bd! – закрыть текущий буфер с терминалом</li>
   <li>:bd! 6 – закрыть конкрентый буфер с терминалом</li>
</ul>

<pre style="margin-top: 6px"><code class="language-vim">:terminal   " открыть терминал
:term       " открыть терминал – короткая форма

:split | terminal   " открыть терминал в отдельном окне
:vsplit | terminal  " открыть терминал – вертикальное разделение

:sp | term    " сокращённая форма
:vs | term    " сокращённая форма

:botright split | terminal  " открыть в новом окне снизу
:botright sp | term         " то же самое – сокращённая форма

:tabnew | terminal   " открыть в новой вкладке
</code></pre>

<p style="margin-bottom: 6px">Настройка терминала (Vim):</p>
<pre style="margin-top: 6px"><code class="language-vim">:set splitbelow   " всегда открывать терминал снизу
:set splitright   " всегда открывать терминал справа

sp | term   " теперь терминал откроется снизу
vs | term   " теперь терминал откроется справа
</code></pre>

<p style="margin-bottom: 6px">Настройка терминала (Lua):</p>
<pre style="margin-top: 6px"><code class="language-lua">vim.opt.splitbelow = true   -- всегда открывать терминал снизу
vim.opt.splitright = true   -- всегда открывать терминал справа   
</code></pre>

<p style="margin-bottom: 6px">Цветовые схемы (Vim)</p>
<pre style="margin-top: 6px"><code class="language-lua">-- Посмотреть цветовую схему:
:echo &background
   -- dark

-- сменить цветовую схему
:colorscheme elflord
:colorscheme habamax

-- вернуть обратно на дефолтную:
:colorscheme default
</code></pre>

<p style="margin-bottom: 6px">Цветовые схемы (Lua)</p>
<pre style="margin-top: 6px"><code class="language-lua">-- lua-обёртка над :-командами Vim
vim.cmd('colorscheme habamax')

-- Lua-синтаксический сахар над vim.cmd(...)
vim.cmd.colorscheme('habamax')

-- Прямой вызов Neovim API – самый низкоуровневый из трёх
-- Устаревающий способ. Менее понятный
vim.api.nvim_command('colorscheme habamax')
</code></pre>

<p style="margin-bottom: 6px">Цвет фона (Lua):</p>
<pre style="margin-top: 6px"><code class="language-lua">vim.api.nvim_set_hl(0, "Normal", { bg = "#21252B"})
  -- 0 – это namespace (пространство имён подсветки)
  -- т.е. 0 = глобальное namespace, означает "применить ко всему редактору"

-- Например, вот этот пример изменит цвет подсветки комментариев везде:
vim.api.nvim_set_hl(0, "Comment", { fg = "#888888" })
  -- "Normal" – highlight-group, самая важная группа
  -- Т.е. "Normal" = базовый стиль всего текста.
  -- Если задать цвет этой группе, фон всего окна редактора изменится

-- { bg = "#21252B" } – это Lua-таблица с атрибутами
</code></pre>

<p style="margin-bottom: 6px">Посмотреть все группы можно с помощью команды:</p>
<pre style="margin-top: 6px"><code class="language-vim">:highlight
</code></pre>

<p style="margin-bottom: 6px"><strong>ВАЖНЫЙ НЮАНС!</strong> Здесь важен порядок:</p>
<pre style="margin-top: 6px; margin-bottom: 6px"><code class="language-lua">vim.cmd('colorscheme habamax')
vim.api.nvim_set_hl(0, "Normal", { bg = "#21252B"})
</code></pre>
<p style="margin-top: 6px">Если поменять местами эти две строчки, то цветовая схема перезапишет цвет фона.</p>

<p style="margin-bottom: 6px">Нумерация строк (Vim)</p>
<pre style="margin-top: 6px"><code class="language-vim">:set number   " включить нумерацию строк
:set nu       " включить нумерацию строк – короткая запись
:set number!  " отключить нумерацию строк
:set nu!      " отключить нумерацию строк – короткая запись

:set relativenumber    " включить относительную нумерацию строк
:set rnu               " включить отн. нумерацию строк – короткая запись
:set relativenumber!   " отключить относительную нумерацию строк
:set rnu!              " отключить отн. нумерацию строк – короткая запись
</code></pre>

<p style="margin-bottom: 6px">Нумерация строк (Lua):</p>
<pre style="margin-top: 6px"><code class="language-lua">vim.opt.number = true    -- включить нумерацию строк
vim.opt.nu = true        -- включить нумерацию строк – короткая запись

vim.opt.number = false   -- отключить нумерацию строк
vim.opt.nu = false       -- отключить нумерацию строк - короткая запись

vim.opt.relativenumber = true  -- включить относительную нумерацию строк
vim.opt rnu = true             -- вкл. отн. нумерацию строк – короткая запись
vim.opt.relativenumber = false -- отключить относительную нумерацию строк
vim.opt rnu = false            -- откл. отн. нумерацию строк – короткая запись
</code></pre>


<p style="margin-bottom: 6px">clipboard:</p>
<pre style="margin-top: 6px"><code class="language-vim"># Проверить, есть ли поддержка clipboard
:echo has("clipboard")
</code></pre>

<p style="margin-bottom: 6px">Посмотреть, откуда читается конфиг:</p>
<pre style="margin-top: 6px"><code class="language-vim">:echo stdpath("config")
</code></pre>

<h2>Автоотступы</h2>

<p style="margin-bottom: 6px">Когда я печатаю HTML, включаются отступы, которые мне мешают. Проверим, какие отступы включены:</p>
<pre style="margin-top: 6px; margin-bottom: 6px"><code class="language-vim">:set autoindent?
 " autoindent

:set smartindent?
 " nosmartindent

:set cindent?
 " nocindent

:set indentexpr?
 " indentexpr=HtmlIndent()

:set filetype?
 " filetype=html
</code></pre>
<p style="margin-top: 6px">В нашем случае виновник: <code style="background-color: #161616; padding: 0 6px">indentexpr=HtmlIndent()</code>. <strong><i>autoindent</i></strong> тут не причём.</p>

<p style="margin-bottom: 6px">Отключим <strong><i>indentexpr</i></strong> сразу же в <strong>Neovim</strong>:</p>
<pre style="margin-top: 6px"><code class="language-vim">:set indentexpr=
</code></pre>

<p style="margin-bottom: 6px">Чтобы отключить автоотступы навсегда, добавим в <strong><i>init.lua</i></strong>:</p>
<pre style="margin-top: 6px"><code class="language-lua">-- ~/.config/nvim/init.lua

vim.api.nvim_create_autocmd("FileType", {
    pattern = "html",
    callback = function()
        vim.opt_local.indentexpr = ""
    end,
})
</code></pre>

<p style="margin-bottom: 6px">Когда мы запускаем <strong><i>.lua</i></strong>-файл, то у нас тоже включаются автоотступы:</p>
<pre style="margin-top: 6px"><code class="language-vim">:set indentexpr?
" indentexpr=GetLuaIndent()
</code></pre>

<p style="margin-bottom: 6px">Отключим автоотступы для <strong><i>.lua</i></strong>-файлов в <strong><i>init.lua</i></strong>:</p>
<pre style="margin-top: 6px"><code class="language-lua">-- ~/.config/nvim/init.lua

vim.api.nvim_create_autocmd("FileType", {
  pattern = "lua",
  callback = function()
    vim.opt_local.indentexpr = ""
  end,
})
</code></pre>

<h2>Длина отступов</h2>
<p>За длину отступов и табов отвечают переменные: <strong><i>shiftwidth</i></strong> и <strong><i>tabstop</i></strong>. По умолчанию они равны 8. Можно проверить это:</p>
<pre><code class="language-vim">:set shiftwidth?
" shiftwidth=8

:set tabstop?
" tabstop=8
</code></pre>

<p style="margin-bottom: 6px">Если не хочется убирать отступы, то для комфортной работы можно их просто уменьшить:</p>
<pre style="margin-top: 6px"><code class="language-vim">:set shiftwidth=2
:set tabstop=2

" Если нужно, чтобы Tab заменялся пробелами, то:
:set expandtab
</code></pre>

<p style="margin-bottom: 6px">В <strong><i>init.lua</i></strong> это можно записать вот так:</p>
<pre style="margin-top: 6px"><code class="language-lua">-- ~/.config/nvim/init.lua

vim.opt.shiftwidth = 2
vim.opt.tabstop = 2

vim.opt.expandtab = true
</code></pre>

<p style="margin-bottom: 6px">Если я хочу всё то же самое, но чтобы ТОЛЬКО для <strong><i>.lua</i></strong>-файлов, то:</p>
<pre style="margin-top: 6px"><code class="language-lua">-- ~/.config/nvim/init.lua

vim.api.nvim_create_autocmd("FileType", {
  pattern = "lua",
  callback = function()
    vim.opt_local.shiftwidth = 2
    vim.opt_local.tabstop = 2
    vim.opt_local.expandtab = true
  end,
})
</code></pre>


<h2>Прозрачность</h2>

<p style="margin-bottom: 6px">Мой конфиг с прозрачностью:</p>
<pre style="margin-top: 6px"><code class="language-lua">-- ~/.config/nvim/init.lua

-- UI / цвета
vim.cmd.colorscheme('habamax')
vim.api.nvim_set_hl(0, "Normal", { bg = "NONE" })
vim.api.nvim_set_hl(0, "EndOfBuffer", { bg = "NONE" })
vim.api.nvim_set_hl(0, "StatusLine", { bg = "NONE" })
</code></pre>

<h2>hello world</h2>

<p style="margin-bottom: 6px">Hello World (Vim)</p>
<pre style="margin-top: 6px"><code class="language-vim">:echo "Hello World"
:lua vim.notify("Hello World")
</code></pre>

<p style="margin-bottom: 6px">Hello World (Lua)</p>
<pre style="margin-top: 6px"><code class="language-lua">print("Выводим сообщение")
print("")

-- Или:
vim.notify("Выводим сообщение")
vim.notify("")

-- Или
vim.cmd('echo "Выводим сообщение!"')
vim.cmd('echo ""')

function pipka()
   print("Это функция пипка")
   print("")
end
pipka()
</code></pre>

<p style="margin-bottom: 6px">Создание пользовательской команды:</p>
<pre style="margin-top: 6px"><code class="language-lua">function pupsik()
   print("PUPPSIIIiiiik")
end
-- Создаем команду :Pupsik
vim.api.nvim_create_user_command('Pupsik', pupsik, {})
</code></pre>

<p style="margin-bottom: 6px">И теперь функцию можно вызывать в <strong>nvim</strong>:</p>
<pre style="margin-top: 6px"><code class="language-lua">:Pupsik
</code></pre>


<h2>Пробуем заново</h2>


<p>Базовая подсветка:</p>
<pre><code class="language-lua">
-- ~/.config/nvim/init.lua
vim.opt.number = true
vim.cmd("syntax on")

-- Проверим, что файлы JavaScript правильно определяются
vim.api.nvim_create_autocmd({"BufRead", "BufNewFile"}, {
  pattern = "*.js",
  command = "set filetype=javascript"
})

print("Конфиг загружен")
</code></pre>

<p>Проверить, какая подсветка включена сейчас:</p>
<pre><code class="language-lua">:set syntax?
   -- syntax=javascript
</code></pre>

<p>Проверить Treesitter:</p>
<pre><code class="language-lua">
:checkhealth nvim-treesitter
</code></pre>
<p>У меня ругалось на то, что не установлен tree-sitter-cli! Я его установил:</p>
<pre><code class="language-lua">sudo pacman -S tree-sitter-cli

# Или
npm install -g tree-sitter-cli
</code></pre>

<pre><code class="language-lua">
:lua vim.treesitter.&lt;Tab&gt;
</code></pre>


<p style="margin-bottom: 6px"></p>
<pre style="margin-top: 6px"><code class="language-lua">

</code></pre>

<script src="/assets/highlight/languages/bash.min.js"></script>
<script src="/assets/highlight/languages/lua.min.js"></script>
<script src="/assets/highlight/languages/vim.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>
