<!DOCTYPE html>
<html lang="RU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сеть</title>
    <link rel="stylesheet" href="/assets/styles/style.css">
    <link rel="stylesheet" href="/assets/highlight/styles_custom/androidstudio.css">
</head>
<body>
<script src="/assets/highlight/highlight.min.js"></script>
<a href="/arch">Вернуться назад</a>

<h1>Сеть</h1>

<p>Посмотреть сетевые интерфейсы:</p>
<pre><code class="language-bash">ip link show
  # 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
  #    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
  # 2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
  #    link/ether d8:bb:c1:dc:58:56 brd ff:ff:ff:ff:ff:ff
  #    altname enxd8bbc1dc5856
  # 3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default 
  #    link/ether 2a:07:8b:e9:a0:3f brd ff:ff:ff:ff:ff:ff
</code></pre>

<p>Посмотреть ip-адреса:</p>
<pre><code class="language-bash">ip addr show
  # 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
  #    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
  #    inet 127.0.0.1/8 scope host lo
  #       valid_lft forever preferred_lft forever
  #    inet6 ::1/128 scope host noprefixroute 
  #       valid_lft forever preferred_lft forever
  # 2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
  #    link/ether d8:bb:c1:dc:58:56 brd ff:ff:ff:ff:ff:ff
  #    altname enxd8bbc1dc5856
  #    inet 192.168.1.3/24 brd 192.168.1.255 scope global dynamic noprefixroute enp2s0
  #       valid_lft 81795sec preferred_lft 70995sec
  #    inet6 2a00:1370:8196:28c3:3000:f74d:e82e:e3a6/64 scope global dynamic mngtmpaddr noprefixroute 
  #       valid_lft 567sec preferred_lft 567sec
  #    inet6 fe80::a199:d780:3c3b:e9a2/64 scope link 
  #       valid_lft forever preferred_lft forever
  # 3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
  #    link/ether 2a:07:8b:e9:a0:3f brd ff:ff:ff:ff:ff:ff
  #    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
  #      valid_lft forever preferred_lft forever
</code></pre>

<p>Посмотреть таблицу маршрутов:</p>
<pre><code class="language-bash">ip route show
   # default via 192.168.1.1 dev enp2s0 proto dhcp src 192.168.1.3 metric 1002 
   # 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 
   # 192.168.1.0/24 dev enp2s0 proto dhcp scope link src 192.168.1.3 metric 1002 
</code></pre>
<p>default via 192.168.1.1 dev enp2s0 proto dhcp src 192.168.1.3 metric 1002</p>
<ul>
    <li>default – маршрут по умолчанию</li>
    <li>via 192.168.1.1 – адрес шлюза</li>
    <li>dev enp2s0 – имя сетевого интерфейса, через который пакет выйдет</li>
    <li>proto dhcp – протокол, который создал этот маршрут. NetworkManager получил параметры маршрутов через DHCP от роутера.</li>
    <li>src 192.168.1.3 – IP, который будет использоваться как исходный</li>
    <li>metric 1002 – это вес маршрута</li>
</ul>

<p>192.168.1.0/24 dev enp2s0 proto dhcp scope link src 192.168.1.3 metric 1002</p>
<ul>
    <li>...</li>
    <li>scope link – этот маршрут доступен только через L2-сеть (через прямое подключение к интерфейсу), т.е. внутри локальной сети, без выхода на gateway.</li>
    <li>...</li>
</ul>

<p>Посмотреть адреса DNS-серверов:</p>
<pre><code class="language-bash">cat /etc/resolv.conf
   # nameserver 192.168.1.1
   # nameserver fe80::1%enp2s0
</code></pre>

<p style="margin-bottom: 4px">Включить интерфейс:</p>
<pre style="margin-top: 4px"><code class="language-bash">sudo ip link set dev enp2s0 up
</code></pre>

<p style="margin-bottom: 4px">Назначить IP-адрес:</p>
<pre style="margin-top: 4px"><code class="language-bash">sudo ip addr add 192.168.1.25/24 dev enp2s0
</code></pre>

<p>Прописать маршрут:</p>
<pre><code class="language-bash">sudo route add default via 192.168.1.1 dev enp2s0

# тут мы говорим, чтобы по умолчанию все пакеты отправлялись через интерфейс enp2s0 на шлюз 192.168.1.1
</code></pre>

<p>Ещё примеры:</p>
<pre><code class="language-bash">
# Чтобы попасть в сеть 10.0.0.x, используй шлюз 192.168.1.1 по интерфейсу enp2s0:
sudo ip route add 10.0.0.0/24 via 192.168.1.1 dev enp2s0

# Единственный IP 10.0.0.50 будет ходить через указанный шлюз:
sudo ip route add 10.0.0.50 via 192.168.1.1 dev enp2s0

# Маршрут напрямую через интерфейс (без via):
sudo ip route add 10.0.0.0/24 dev enp2s0
   # Тут нет шлюза, пакеты отправляются напрямую (L2-доступ, ARP)

# С указанием источника (source-based routing):
sudo ip route add 10.0.0.0/24 dev enp2s0 src 10.0.0.100

# С метрикой:
sudo ip route add 10.0.0.0/24 via 192.168.1.1 dev enp2s0 metric 50
</code></pre>

<h3>Сетевые менеджеры</h3>
<ul>
    <li>systemd-networkd</li>
    <li>NetworkManager</li>
    <li>dhcpcd</li>
    <li>connman</li>
</ul>

<script src="/assets/highlight/languages/bash.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>