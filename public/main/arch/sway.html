<!DOCTYPE html>
<html lang="RU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sway</title>
    <link rel="stylesheet" href="/assets/highlight/styles_custom/androidstudio.css">
	<link rel="stylesheet" href="/assets/styles/style.css">
</head>
<body>
<script src="/assets/highlight/highlight.min.js"></script>
<a href="/arch">Вернуться назад</a>

<h1>sway</h1>

<p>!!! Никогда не надо запускать SWAY (и любые другие WAYLAND-сессии) через sudo</p>
<h3>Установка Sway</h4>

<ul>
<li>Для запуска <strong><i>sway</i></strong> нам понадобится <strong><i>mesa</i></strong>. Без Mesa <strong><i>sway</i></strong> не запустится на обычной Linux-системе с <strong><i>Intel/AMD</i></strong> GPU. Mesa – это реализация OpenGL для Linux/Unix.</li>
<li>Также нам понадобится терминал <strong><i>foot</i></strong>. По умолчанию конфигурационный файл sway настроен именно на запуск <strong><i>foot</i></strong> сочетанием клавиш Win+Enter. Если <strong><i>foot</i></strong> не установить, то мы не сможем зайти в терминал.</li>
</ul>
<p><strong><i>wlroots</i></strong> (отдельно ставить не надо) – это библиотека для Wayland-композиторов (Sway, Wayfire etc.). Она управляет мониторами, окнами, вводом с клавиатуры и мыши, рендерингом через OpenGL. Sway не напрямую работает с GPU — он использует wlroots, а wlroots уже использует OpenGL (через Mesa) для отрисовки окон и эффектов.</p>

<pre><code class="language-bash"># минимальный минимум для запуска sway:
sudo pacman -S mesa sway foot

# Для запуска X11-программ:
sudo pacman -S xorg-xwayland
</code></pre>

<h2>Инструменты sway</h2>
<p>Вместе со sway ставятся также и утилиты-помощники:</p>
<ul>
	<li>swaymsg</li>
	<li>swaynag</li>
</ul>


<h2>Запуск</h2>
<pre><code> dbus-run-session -- sway
 dbus-run-session sway
 dbus-run-session sway > ~/.sway.log 2>&1
 exec sway</code></pre>


<p>Sway запустился. Единственное, что отображается на экране по умолчанию – это <strong><i>swaybar</i></strong> наверху. <strong><i>Swaybar</i></strong> – это встроенная панель, входящая в состав самого пакета sway. Настроить её можно в конфигурационном файле sway, в  разделе <strong><i>bar</i></strong>.</p>

<h4>Основные команды управления sway:</h4>
<pre><code class="language-bash"># Win+Enter – Открыть окно терминала
swaymsg kill     # Win+Shift+Q – закрыть окно
swaymsg exit     # Win+Shift+E – выйти из sway (нужно будет подтвердить, кликнув мышкой)
swaymsg reload   # Win+Shift+C – перезагрузка конфигурации без выхода из сессии
</code></pre>
<p>Первое, что бросается мне в глаза – это мелкий шрифт в терминале. Чтобы его поменять пишем в конфигурационный файл foot:</p>
<pre><code class="language-ini"># ~/.config/foot/foot.ini

[main]
font=monospace:size=14      # увеличиваем шрифт с 8 до 14
dpi-aware=yes
</code></pre>
<pre><code class="language-bash"># Можно скопировать шаблон конфига:

cp /etc/xdg/foot/foot.ini ~/.config/foot/foot.ini
</code></pre>





<h2>Конфигурационный файл SWAY</h2>

<p>Конфигурационный файл находится здесь: <strong><i>/etc/sway/config</i></strong>. Скопируем его в домашнюю директорию:</p>

<pre><code class="language-bash">mkdir -p ~/.config/sway
cp /etc/sway/config ~/.config/sway/</code></pre>

<p>Первое, что следует сделать для удобства – это добавить русскую раскладку и Compose-key:</p>
<pre><code># Раскладка клавиатуры: английская и русская,
# смена языка – на Alt+Shift:
input * {
   xkb_layout us,ru
   xkb_options grp:alt_shift_toggle
}

# То же, но добавим ещё Compose-key на правый Alt:
input * {
   xkb_layout us,ru
   xkb_options grp:alt_shift_toggle,compose:ralt
}

# grp:alt_shift_toggle — это переключение раскладки Alt+Shift
# compose:ralt — это назначение правого Alt как Compose-клавиши
</code></pre>

<p>Вместе со <strong><i>sway</i></strong> у нас ещё загрузились в систему несколько обоев для рабочего стола – в папку <strong><i>/usr/share/backgrounds/sway/</i></strong>. А в config'е можно найти вот такую строку:</p>
<pre><code>output * bg /usr/share/backgrounds/sway/Sway_Wallpaper_Blue_1920x1080.png fill
</code></pre>
<p>Это означает, что файл <strong><i>Sway_Wallpaper_Blue_1920x1080.png</i></strong> должен отображаться в качестве фона рабочего стола. Но у нас рабочий стол чёрный. А всё потому, что эта команда в конфиге "под капотом" использует программу <strong><i>swaybg</i></strong> для того, чтобы установить обои. То есть <strong><i>swaybg</i></strong> у нас не установлен, но в дефолтном конфиге уже есть включённая настройка, которая использует <strong><i>swaybg</i></strong> для того, чтобы вывести на рабочий стол обои <strong><i>Sway_Wallpaper_Blue_1920x1080.png</i></strong>. Более того, если мы выйдем в TTY, то увидим что-то типа:</p>
<pre><code class="lagnuage-bash">00:00:00.356 [sway/config.c:1083] failed to execute 'swaybg' (background configuration probably not applied): No such file or directory
</code></pre>

<p>А это значит, что дефолтные обои у нас уже настроены, но пока не установлен <strong><i>swaybg</i></strong>. Из-за этого обои и не отображаются. Поэтому просто устанавливаем <strong><i>swaybg</i></strong> и перезагружаем конфиг: Win+Shift+C. Всё. Обои подгрузились.</p>




<h3>РАЗРЕШЕНИЕ И ЧАСТОТА</h3>
	
		
<pre><code class="language-bash"># Посмотретьтекущие настройки:
   swaymsg -t get_outputs
      # выведет допустимые разрешения и частоты
# или:
   wayland-info	## пакет wayland-utils
# или:
   wlr-randr		## wlr-randr

# Чтобы поменять разрешение и частоту навсегда, надо внести эту строку в ~/.config/sway/config:
   swaymsg output HDMI-A-2 mode 1920x1080@144Hz
</code></pre>
		
<h4>Чтобы поменять разрешение и частоту навсегда, надо внести эту строку в ~/.config/sway/config:</h4>
<pre><code>output HDMI-A-2 mode 1920x1080@144Hz</code></pre>
	

<h2>Переменные среды</h2>
<ul>
	<li>XDG_CURRENT_DESKTOP: sway</li>
	<li>XDG_SESSION_TYPE: wayland (значение по умолчанию)</li>
	<li>WAYLAND_DISPLAY: wayland-1 (значение по умолчанию)</li>
	<li>DISPLAY: :0 (значение по умолчанию)</li>
</ul>

<h2>Лаунчер</h2>
<p>Чтобы можно было удобно запускать приложения:</p>
<pre><code class="language-bash">sudo pacman -S wofi

# И создаём конфиг:
mkdir -p ~/.config/wofi
</code></pre>

<p>Запуск wofi:</p>
<pre><code class="language-bash">wofi --show drun

# или:
wofi --show run
</code></pre>

<p>В конфиге запуск лаунчера уже назначен на сочетание клавиш <strong><i>Win+D</i></strong>. По умолчанию там указан лаунчер <strong><i>wmenu-run</i></strong>. Просто закомментируем его и назначим наш <strong><i>wofi</i></strong>.</p>
<pre><code class="language-bash"># Your preferred application launcher
# set $menu wmenu-run
set $menu wofi --show drun

# Start your launcher
bindsym --to-code  $mod+d exec $menu
</code></pre>

<h2>wlogout</h2>
<p>AUR. Для работы необходим <strong><i>xwayland</i></strong>.</p>
<p>Чтобы можно было нормально выходить из системы.</p>
<p>При этом у меня по умолчанию не создался .desktop-файл в <strong><i>/usr/share/applications</i></strong>, поэтому <strong><i>wofi</i></strong> не запускает <strong><i>wlogout</i></strong>. Создадим сами wlogout.desktop в <strong></i>~/.local/share/applications</i></strong>.</p>

<pre><code class="language-ini">[Desktop Entry]
Type=Application
Name=wlogout
Exec=wlogout
Terminal=false
</code></pre>
<p>И обновим кэш:</p>
<pre><code class="language-bash">update-desktop-database ~/.local/share/applications
</code></pre>

<h2>Текстовый редактор</h2>

<p>Например, <strong><i>Featherpad</i></strong>.</p>

<h2>Браузер</h2>
<p>Теперь неплохо бы установить браузер, чтобы можно было выходить в интернет. Firefox вроде бы как нативно поддерживает wayland.</p>
<pre><code class="language-bash">sudo pacman -S firefox
</code></pre>

<h2>Файловый менеджер</h2>
<ul>
   <li>thunar</li>
   <li>pcmanfm</li>
</ul>

<h2>ntfs-3g</h2>
<p>Понадобится, если планируем подключать диски с файловой системой NTFS.</p>

<h2>Видео-проигрыватель</h2>
<p>mpv – и вот тут уже пригодится VAAPI (intel-media-driver, libva-utils)</p>

<p>Чтобы проверить, установлен VAAPI, или нет, сначала поставим libva-utils:</p>
<pre><code class="language-bash">sudo pacman -S libva-utils

# И запустим:
vainfo
</code></pre>
<p>Если VA-API работает — увидим что-то вроде «VA-API version: …», список поддерживаемых кодеков и драйвер. Если команда выдаёт ошибку ("cannot open driver", "va_openDriver failed" и т.п.), значит либо драйвер не установлен/не подходит, либо конфигурация не позволяет VA-API работать.</p>

<p>Если intel-media-driver не установлен, тогда ставим его:</p>
<pre><code class="language-bash">sudo pacman -S intel-media-driver

# И опять проверяем:
vainfo
</code></pre>

<p>Установим mpv:</p>
<pre><code class="language-bash">sudo pacman -S mpv
</code></pre>

<p>Чтобы проверить, использует ли mpv аппаратное декодирование, запустим видео файл:</p>
<pre><code class="language-bash">mpv --hwdec=vaapi --vo=gpu --gpu-context=wayland some_video.mkv

  # ...
  # Using hardware decoding (vaapi).
  # AO: [pipewire] 48000Hz stereo 2ch floatp
  # VO: [gpu] 1024x576 vaapi[nv12]
  # AV: 00:00:38 / 01:20:45 (1%) A-V:  0.000 Cache: 598s/150MB
</code></pre>
<p>Здесь мы видим строку: <i>Using hardware decoding (vaapi)</i>. Значит, аппаратное декодирование работает.</p>

<p>Если мы хотим получить больше информации, например, узнать используется wayland или xwayland, то можно запустить команду вот так:</p>
<pre><code class="language-bash">mpv --hwdec=vaapi --vo=gpu --gpu-context=wayland --msg-level=vo=v some_video.mkv
</code></pre>
<ul>
   <li>--hwdec=vaapig – включить аппаратное ускорение</li>
   <li>--vo=gpu – в качестве Video Output исользовать OpenGL/Vulkan</li>
   <li>--gpu-context=wayland – использовать в качестве контекста wayland</li>
</ul>

<p>Чтобы все эти опции запускались, когда мы кликаем по файлу, нужно прописать их в конфиг:</p>
<pre><code class="language-bash"># ~/.config/mpv/mpv.conf

hwdec=vaapi
vo=gpu
gpu-context=wayland
</code></pre>
<p>Теперь можно просто запускать файл командой:</p>
<pre><code class="language-bash">mpv filename.mkv
</code></pre>

<p>ГПТ посоветовал такой конфиг для макс. качества изображения:</p>
<pre><code class="language-bash">hwdec=vaapi
vo=gpu
gpu-context=wayland
profile=gpu-hq
scale=ewa_lanczossharp
cscale=ewa_lanczossharp
dscale=mitchell
video-sync=display-resample
interpolation
tscale=oversample
</code></pre>

<h2>Аудио-проигрыватель</h2>
<p>И тут придётся разобраться с ALSA, PipeWire... pavucontrol</p>

<h2>Громкость</h2>
<p>Чтобы можно было регулировать громкость звука в системе, поставим <strong><i>pavucontrol</i></strong>:</p>
<pre><code class="language-bash">sudo pacman -S pavucontrol
</code></pre>


<h2>swaybar – раскладка</h2>
<p>По умолчанию в waybar'е отображается только год, месяц, дата и текущее время. За этот вывод в конфиге отвечает вот этот блок:</p>

<pre><code class="language-bash">#
# Status Bar:
#
# Read `man 5 sway-bar` for more information about this section.
bar {
    position bottom

    # When the status_command prints a new line to stdout, swaybar updates.
    # The default just shows the current date and time.
    status_command while date +'%Y-%m-%d %X'; do sleep 1; done

    colors {
        statusline #ffffff
        background #323232
        inactive_workspace #32323200 #32323200 #5c5c5c
    }
}
</code></pre>

<p>Всю работу здесь выполняет эта строка:</p>
<pre><code class="language-bash">status_command while date +'%Y-%m-%d %X'; do sleep 1; done
</code></pre>

<p>Создадим файл ~/.config/sway/status.sh:</p>
<pre><code class="language-bash">#!/bin/bash

while true; do
    # Получаем раскладку
    layout=$(swaymsg -t get_inputs | jq -r '.[] | select(.type=="keyboard") | .xkb_active_layout_name' | head -n 1)

    # Преобразуем в RU/EN
    case "$layout" in
        "Russian") layout="RU" ;;
        "English (US)") layout="EN" ;;
    esac

    # Вывод строки в бар
    echo "$layout | $(date +'%Y-%m-%d %H:%M:%S')"

    sleep 1
done
</code></pre>

<p>Сделаем этот файл исполняемым:</p>
<pre><code class="language-bash">chmod +x ~/.config/sway/status.sh
</code></pre>

<p>И теперь заменим <strong><i>status_command</i></strong> в конфиге на:</p>
<pre><code class="language-bash">status_command ~/.config/sway/status.sh
</code></pre>

<p>А ещё мне не нравится чисто белый цвет текста в статус-баре. Мне больше нравится цвет: #BAC3BC.</p>

<pre><code class="language-bash">
bar {
   ...
   colors {
      statusline #bac3bc
      ...
   }
}
</code></pre>

<p>Осталось перезагрузить конфиг sway (Mod+Shift+C) и в панели появится обозначение текущей раскладки.</p>


<h2>waybar</h2>
<pre><code class="language-bash">
## Запуск waybar:
   exec_always "pgrep -x waybar || waybar"
   # И надо обязательно закомментировать блок "bar", который отвечает за запуск swaybar, иначе при старте запустится дефолтный swaybar
</code></pre>	


<h3>swaylock и swayidle</h3>

<pre><code class="language-bash"># Устанавливаем их:

sudo pacman -S swaylock swayidle

# Запустить блокировщик с тёмным фоном:
swaylock -c 222222

#
swayidle -w \
   timeout 300 'swaylock -c 222222' \
   timeout 600 'swaymsg "output * dpms off"' \
      resume 'swaymsg "output * dpms on"'
</code></pre>

<ul>
   <li>-w – wait – не форкается в фон, а висит на переднем плане</li>
   <li>swaymsg "output * dpms off" – выключить мониторы по DPMS (экран гаснет, как будто ушёл спать)</li>
   <li>swaymsg "output * dpms on" – включить мониторы обратно</li>
   <li>timeout 300 'команда' – выполнять команду по истечении 300 секунд</li>
   <li>resume – привязан к timeout 600 – запускать команду при любом вводе (движение мыши, нажатие клавиши)</li>
</ul>

<p>Можно просто добавить команду запуска <strong><i>swayidle</i></strong> в конфиг <strong><i>sway</i></strong>:</p>
<pre><code class="language-bash"># ~/.config/sway/config

exec swayidle -w \
   timeout 300 'swaylock -c 222222' \
   timeout 600 'swaymsg "output * dpms off"' \
      resume 'swaymsg "output * dpms on"'
</code></pre>

<pre><code class="language-bash"># Получаю такое вот странное предупреждение, хотя всё работет:

swayidle -w timeout 10 'swaylock -c 222222'
  # 2025-12-03 00:35:36 - [Line 277] Failed to parse get BlockInhibited property: Invalid argument
</code></pre>

<p>Строка означает: «не получилось корректно прочитать свойство BlockInhibited у logind, но идём дальше». Предупреждение полность безопасное. У swayidle есть логика общения с org.freedesktop.login1 через D-Bus. Причём включает она это автоматически, если login1 присутствует (как раз как у меня).</p>

<p style="margin-bottom: 6px">Проверка свойства BlockInhibited:</p>
<pre style="margin-top: 6px"><code class="language-bash">busctl introspect org.freedesktop.login1 /org/freedesktop/login1 | grep BlockInhibited
  # .BlockInhibited    property  s    ""   emits-change
</code></pre>

<ul>
   <li>"" – пустая строка означает, что сейчас ничего не блокирует idle/sleep (ни плееры, ни другие программы)</li>
   <li>emits-change — logind шлёт сигнал, если значение меняется</li>
</ul>

<p>Посмотреть список ингибиторов:</p>
<pre><code class="language-bash">systemd-inhibit --list
</code></pre>
	
<pre><code class="language-bash"># Запускаем:
systemd-inhibit --what=idle sleep 10

# И проверяем ингибиторы:
systemd-inhibit --list
</code></pre>

<h2>Калькулятор</h2>
<ul>
   <li>qalculate-gtk</li>
   <li>gnome-calculator</li>
   <li>kcalc</li>
</ul>


<h3>Всё остальное</h3>
	<pre><code class="language-bash">
	# grim + slurp - Скриншоты экрана
	# imagemagick - узнать цвет пикселя
		sudo pacman -S grim slurp imagemagic
		grim out.png	## делает скриншот
		grim -g "$(slurp)" out.png		## делает скриншот выделенной области
		grim -g "$(slurp -p)" -t ppm - | convert - txt:- | grep -m1 -oP '#\w{6}'
			slurp -p — ждёт клик по экрану и возвращает координаты 1×1 пикселя
			grim -g — делает скриншот только этого пикселя
			convert — анализирует цвет и выводит HEX
			grep — оставляет только #RRGGBB



	## Создаём скрипт, который определяет цвет пикселя в файле ~/.local/bin/pipette:
		
		#!/usr/bin/env bash						## - шейбанг (shebang)

		# Делаем скрин выделенной области
		COLOR=$(grim -g "$(slurp -p)" -t ppm - \
    		| convert - txt:- \
    		| grep -m1 -oP '#\w{6}')
		
		# Если пользователь нажал Esc и цвет не выбран
		[ -z "$COLOR" ] && exit 0
		
		# Копируем цвет в буфер обмена
		echo -n "$COLOR" | wl-copy
		
		# Создаем маленькую цветную иконку 64x64 для уведомления
		convert -size 64x64 xc:"$COLOR" /tmp/color.png
		
		# Показываем уведомление
		notify-send -i /tmp/color.png "Цвет скопирован" "$COLOR"
	</code></pre>	
	
	<h3>Уведомления</h3>
	<pre><code class="language-bash">	
		# Ставим mako:
			sudo pacman -S mako
		# Теперь можно выводить увеодмления через:
			mako "Header" "This it the message"
		## Конфигурационный файл здесь: ~/.config/mako/config:
		## Пример простого конфига:
			# Время показа уведомления
			default-timeout=3000
			
			# Цвета и прозрачность
			background-color=#222222
			text-color=#eeeeee
			border-color=#555555
			
			# Толщина и закругление рамки
			border-size=2
			border-radius=8
			
			# Положение экрана (например, сверху-право)
			anchor=top-right
			
			# Отступы
			margin=10
			padding=10
</code></pre>

		<pre><code class="language-bash">
		## Win+Print - Делаем скриншот всего экрана:
		bindsym $mod+Print exec sh -c 'file=~/Pictures/screenshot-$(date +%Y-%m-%d_%H-%M-%S).png; grim "$file" && notify-send "Скриншот" "Сохранён в $file"'
		## Win+Shift+Print - Делаем скриншот выделенной области:
		bindsym $mod+Shift+Print exec sh -c 'file=~/Pictures/screenshot-$(date +%Y-%m-%d_%H-%M-%S).png; grim -g "$(slurp)" "$file" && notify-send "Скриншот" "Сохранён в $file"'		
		## Win+Shift+p - Узнать цвет пипеткой (запускаем скрипт из файла ~/.local/bin/pipette):
		bindsym $mod+Shift+p exec ~/.local/bin/pipette   
		</code></pre>
		

		
		<pre><code class="language-bash">
	# seatd / elogind - для управления доступом к вводу/выводу 
	# xdg-desktop-portal-wlr - для поддержки XDG-порталов (например, открыть файл в диалоге)
	# wlroots - Библиотека, на которой работает sway


	# dillo - минималистичный браузер
	# falkon - браузер чуть получше
	# Loupe - нормальный вьюер
	# wofi / bemenu - лаунчеры
	# waybar - панель статуса (вместо swaybar)
	# swaylock, swayidle - Блокировка экрана и автовыход в сон
	# brightnessctl - Яркость экрана
	# Wlogout (AUR) — красивое окно выхода/перезагрузки/выключения.
	# mc - GNU Midnight Commander - файловый менеджер
	# lf - файловый менеджер
	# krusader - файловый менеджер / подтягивает и kde/qt библиотеки
	# qtfm - минималистичный графический файловый менеджер на qt
	# pcmanfm / pcmanfm-gtk3 / pcmanfm-qt - графический файловый менеджер не gtk/qt
		# lxappearance - настройка gtk-тем
		# adapta-gtk-theme - Adapta-Notko
	
	## Торент-клиенты
		# fragments - на gkt
		# qbittorrent - на qt
		
	## Аудиоплееры
		# DeaDBeef	- на хз
		# Amberol	- на gtk
				
	# mako - уведомления
	# networkmanager + nmcli / nmtui - Управление сетью
	
	# cava - терминальный аудио-визуализатор
	# xfe (AUR) - простенький графический файловый менеджер, без зависимостей типа GTK или QT
	# worker (AUR) - графический файловый менеджер, ещё проще
	
	# mattermost - что-то типа Slack или Microsoft Teams
	# logseq (AUR)- бесплатный аналог obsidian
	# appflowy (AUR), anytype (AUR) - free notion
	# focalboard (AUR) - free trello
	# nextcloud - ХЗ. Что-то с хранением файлов на сервере. В том числе аудио- и видеозвонки и Sceen Sharing
</code></pre>

<script src="/assets/highlight/languages/bash.min.js"></script>
<script src="/assets/highlight/languages/ini.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>