<!DOCTYPE html>
<html lang="RU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pacman</title>
    <link rel="stylesheet" href="/assets/styles/style.css">
	<link rel="stylesheet" href="/assets/highlight/styles_custom/androidstudio.css">
</head>
<body>
<script src="/assets/highlight/highlight.min.js"></script>
<a href="/arch">Вернуться назад</a>

    <h1>Pacman</h1>

	<pre><code class="language-bash">
  # update system
  # sudo pacman -Syu
  	-S - Synchronize: Install or update packages
  	-y - Refresh package database (download the latest package lists)
  	-u - Upgrade all installed packages to the latest version
  # Refresh package list (not upgrade):
  	sudo pacman -Sy
  
  # Remove
  sudo pacman -Rns budgie-desktop gnome xfce4 xfce4-goodies
  	-R - remove a packager
  	-n - remove configuration files and mark dependencies as unused
  	-s - remove unused dependencies that were installed with the package
  sudo pacman -Rdd linux-firmware
  	-R - удалить пакет
  	-d - игнорировать зависимости (один -d)
  	-dd - игнорировать зависимости дважды (то есть вообще никакие зависимости):
  		- не проверят, что от пакета кто-то зависит (обратные зависимости);
  		- не проверять, что сам пакет зависит от чего-то.
  
  # Search package in repo
  sudo pacman -Ss lalal
  	-S - Syncronize
  	-s - search
  # Хочу узнать, что входит в пакет, который я установил.
  # Например, я ставлю Sway и хочу знать, ЧТО установится:
  pacman -Qi sway
  # Найти, установлен ли у меня метапакет. Выведен всё, что он установил:
  pacman -Qg plasma
  
  # Хочу узнать, что входит в пакет, который я ещё не установил:
  pacman -Si sway
  # Посмотреть что включает в себя метапакет:
  pacman -Sg plasma
  
  # Узнать, установлен ли у меня пакет:
  pacman -Q xorg-server
	</code></pre>
	
	<ul>
		<li>/var/cache/pacman/pkg/ - Каталог для кэша → это именно пакеты (*.pkg.tar.zst), которые pacman скачивает.</li>
		<li>/var/lib/pacman/ - Каталог баз данных → там лежат репозитории (файлы с информацией о пакетах).
Если ты удалишь "неиспользуемые репозитории", это просто почистит каталоги баз тех репозиториев, которые у тебя больше не подключены в /etc/pacman.conf.</li>
		<li>/var/lib/pacman/local/ - Здесь хранятся данные обо всех установленных пакетах (каждый пакет — отдельная папка).
Внутри есть файлы вроде desc, files, где перечислены версия, зависимости, список установленных файлов и т. д. Это и есть «реестр» pacman'а.</li>
		<li>/var/lib/pacman/sync - Здесь хранятся локальные копии баз данных репозиториев (например core.db, extra.db, community.db). Когда я выполняю: pacman -Sy или -Syu, они обновляются.</li>
		<li>/var/lib/pacman/sync - Здесь также хранятся локальные копии баз данных файлов (например core.files, extra.files, multilib.files). Когда я выполняю: pacman -Fy, они обновляются.</li>
	</ul>
	
	<pre><code class="language-bash">
# Очистить кэш pacman:
  sudo pacman -Sc
  # Удаляет старые версии пакетов из /var/cache/pacman/pkg/
  # но оставляет последнюю скачанную версию каждого пакета
  # (чтобы можно было переустановить без интернета).
  
  # Также удаляет неиспользуемые репозитории из /var/lib/pacman/sync/
  # То есть если я удалю из /etc/pacman.conf:
  #   [multilib]
  #   Include = /etc/pacman.d/mirrorlist
  # а потом запущу команду "sudo pacman -Sc" -
  # тогда pacman удалит копию репозитория /var/lib/pacman/sync/multilib.db
  
  sudo pacman -Scc
  # удаляет вообще всё из /var/cache/pacman/pkg/ (и старые, и последние версии).
  # pacman даже предупреждает:
  # "Удаление всех пакетов может привести к невозможности переустановки без скачивания заново".
  
  # Чистит только /var/cache/pacman/pkg/ и /var/lib/pacman/
  # 
  # Папку ~/.cache/ не очищает
	</code></pre>
	
   	<h4>То есть:</h4>
	<ul>
		<li>Если хочешь немного освободить место, но оставить возможность быстро переустановить → pacman -Sc.</li>
		<li>Если хочешь чистый кэш, всё скачать заново при необходимости → pacman -Scc.</li>
	</ul>
	
   	<h4>Для AUR ситуация схожа:</h4>
	<ul>
		<li>yay -Sc — чистит старые, оставляет актуальные сборки.</li>
		<li>yay -Scc — чистит вообще всё, но git-репозитории пакетов остаются (в ~/.cache/yay).</li>
	</ul>

	<pre><code class="language-bash">
   # ~/.cache/yay/ - кэш yay
   
   # yay -Sc	 - делает не только очистку своего кэша, но ещё и проксирует вызов в pacman -Sc.
   yay -Sc	# очистка обоих кэшей - и yay, и pacman
   yay -Sc --yay	# почистить только кэш yay, без затрагивания pacman
   yay -Sc --pacman	# почистить pacman, не затрагивая yay
   
   yay -Scc	# очистка обоих кэшей - и yay, и pacman
   yay -Scc --yay	# почистить только кэш yay, без pacman
   yay -Scc --pacman	# почистить только кэш pacman, без yay
	</code></pre>
	
	<pre><code class="language-bash">
   # ~/.cache/paru/ - кэш paru
   
   paru -Sc	# очитска обоих кэшей - и paru, и pacman
   paru -Sc --paru	# очистить только кэш paru
   paru -Sc --pacman	# очистить только кэш pacman
   
   paru -Scc	# очистить оба кэша - и paru, и pacman
   paru -Scc --paru	# очистть только кэш paru
   paru -Scc --pacman	# очистить только кэш pacman
	</code></pre>


	<h4>Скачать пакет, но не устанавливать его</h4>
	<pre><code class="language-bash">
# Скачать пакет в домашнюю папку:
sudo pacman -Sw vim --cachedir="/home/mark"

# А так пакет скачается в /var/cache/pacman/pkg/
sudo pacman -Sw vim

# Скачаются два файла:
#    filename.pkg.tar.zst,
#    filename.pkg.tar.zst.sig
	</code></pre>

	<h4>Установить собранный ранее пакет (.pkg.tar.zst):</h4>
	<pre><code class="language-bash">
# Устанавливаем пакет из текущей директории:
sudo pacman -U paru-2.1.0-1-x86_64.pkg.tar.zst

# Если я ранее скачал пакет в /var/cache/pacman/pkg, то ...
# при последующей установке можно не писать путь к нему целиком.
sudo pacman -U filename.pkg.tar.zst
# и pacman найдёт его в /var/cache/pacman/pkg и установит
# (если в текущей папке нет пакета с таким же названием).
</code></pre>
	
	<h4>Узнать, какому пакету принадлежит бинарник:</h4>
	<pre><code class="language-bash">pacman -Qo /usr/bin/package-name</code></pre>
	
	<h4>Узнать, какому пакету принадлежит утилита:</h4>
	<pre><code class="language-bash">
# Например, я хочу установить утилиту netstat.
# Но я не знаю, какой ставить пакет, чтобы я смог ей воспользоваться.
pacman -F netstat

# Теперь я знаю, что утилита netstat ...
# находится в пакете net-tools и просто ставлю этот пакет:
sudo pacman -S net-tools

# Чтобы осуществлять поиск (pacman -F), нужно предварительно ...
# скачать базу данных файлов себе в локальное хранилище (/var/lib/pacman/sync):
sudo pacman -Fy
	</code></pre>
	
	<h4>Расшифровка</h4>
	<pre><code class="language-bash">
sudo pacman -Syu
sudo pacman --sync --refresh --sysupgrade

sudo pacman -Rns
sudo pacman --remove --nosave --recursive

sudo pacman -Sw vim --cachedir="/home/mark"
sudo pacman --sync --downloadonly --cachedir="/home/mark"

sudo pacman -U package.pkg.tar.zst
sudo pacman --upgrade package.pkg.tar.zst

sudo pacman -Fy
sudo pacman --files --refresh
	</code></pre>

<script src="/assets/highlight/languages/bash.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>